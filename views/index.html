<!DOCTYPE html>
<html lang="fa">
<head>
  <meta charset="UTF-8" />
  <title>فرم مینی‌اپ بله</title>
  <style>
    body {
      font-family: sans-serif;
      background: #f2f2f2;
      padding: 20px;
    }
    form {
      background: white;
      padding: 20px;
      border-radius: 10px;
      max-width: 400px;
      margin: auto;
    }
    input, button {
      width: 100%;
      padding: 10px;
      margin-top: 10px;
      font-size: 16px;
    }
    button {
      background-color: #2e89ff;
      color: white;
      border: none;
      border-radius: 5px;
    }
  </style>
</head>
<body>
  <form id="userForm">
    <h2>فرم اطلاعات</h2>
    <input type="text" name="name" placeholder="نام" required />
    <input type="text" name="phone" placeholder="شماره موبایل" required />
    <button type="submit">ارسال</button>
  </form>

  <script>
    document.getElementById("userForm").addEventListener("submit", async function (e) {
      e.preventDefault();

      const name = this.name.value;
      const phone = this.phone.value;
      const userAgent = navigator.userAgent;
      const timestamp = new Date().toLocaleString('fa-IR');

      let userId = "نامشخص";
      let username = "نامشخص";

      // گرفتن اطلاعات از BaleMiniApp SDK
      if (window.BaleMiniApp) {
        try {
          const user = await BaleMiniApp.getUserInfo();
          userId = user.id;
          username = user.username || "ندارد";
        } catch (err) {
          console.error("خطا در دریافت اطلاعات از بله:", err);
        }
      }

      const payload = {
        name,
        phone,
        userId,
        username,
        timestamp,
        userAgent,
      };

      // ارسال به سرور Node.js
      const res = await fetch("/submit", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(payload),
      });

      const result = await res.text();
      alert(result);
    });
  </script>
</body>
</html>
